<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Grigorios Papageorgiou" />

<meta name="date" content="2021-03-09" />

<title>Joint Models with Multi-state processes</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Joint Models with Multi-state processes</h1>
<h4 class="author">Grigorios Papageorgiou</h4>
<h4 class="date">2021-03-09</h4>


<div id="TOC">
<ul>
<li><a href="#multi-state-processes">Multi-state Processes</a>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#data">Data</a></li>
<li><a href="#fitting-the-model">Fitting the model</a></li>
</ul></li>
</ul>
</div>

<div id="multi-state-processes" class="section level1">
<h1>Multi-state Processes</h1>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>It is very often the case that a subject may transition between multiple states and we are interested to assess the association of longitudinal marker(s) with each of these transitions. In this vignette we will illustrate how to do so using <strong>JMbayes2</strong>.</p>
<p>We will consider a simple case with one longitudinal outcome and a three-state (illness-death) model, but this application can be extended for the cases of multiple longitudinal markers and more than three states.</p>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>First we will simulate data from a joint model with a single linear mixed effects model and a multi-state process with three possible states. The multi-state process can be visualized as:</p>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>where all subjects start from state “Healthy” and then can transition to either state “Illness” and then state “Death” or directly to state “Death”. In this case, states “Healthy” and “Illness” are <em>transient</em> states as the subject, when occupying these states, can still transition to other states whereas “Death” is an absorbing state as when a subject reaches this state then no further transitions can occur. This means that three transitions are possible: <span class="math inline">\(1 \rightarrow 2\)</span>, <span class="math inline">\(1 \rightarrow 3\)</span> and <span class="math inline">\(2 \rightarrow 3\)</span> with transition intensities <span class="math inline">\(h_{12}\left(t\right)\)</span>, <span class="math inline">\(h_{13}\left(t\right)\)</span> and <span class="math inline">\(h_{23}\left(t\right)\)</span> respectively.</p>
<p>For our example the default functional form is assumed, i.e., that the linear predictor <span class="math inline">\(\eta(t)\)</span> of the mixed model is associated with the each transition intensity at time <span class="math inline">\(t\)</span>. The following piece of code simulates the data:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># number of subjects</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of measurements per subject  </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># vector of ids</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="at">each =</span> n)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># minimum and maximum follow-up times  </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>min.t <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>max.t <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># sample time-points</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">replicate</span>(N, <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">sort</span>(<span class="fu">runif</span>(n <span class="sc">-</span> <span class="dv">1</span>, <span class="at">min =</span> min.t, <span class="at">max =</span> max.t))), <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">do.call</span>(c, time)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># sample continuous covariate  values</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>Xcov.s <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="at">mean =</span> <span class="fl">4.763</span>, <span class="at">sd =</span> <span class="fl">2.8</span>) <span class="co"># wide version</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>Xcov <span class="ot">&lt;-</span> <span class="fu">rep</span>(Xcov.s, <span class="at">each =</span> n) <span class="co"># long</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># initiate data frame to store results</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;id&quot;</span> <span class="ot">=</span> id, <span class="st">&quot;time&quot;</span> <span class="ot">=</span> time, <span class="st">&quot;X&quot;</span> <span class="ot">=</span> Xcov)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># design matrices for fixed and random effects  </span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> time <span class="sc">+</span> X, <span class="at">data =</span> DF)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> time, <span class="at">data =</span> DF)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>D11 <span class="ot">&lt;-</span> <span class="fl">1.0</span> <span class="co"># variance of random intercepts</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>D22 <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># variance of random slopes</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># we simulate random effects</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rnorm</span>(N, <span class="at">sd =</span> <span class="fu">sqrt</span>(D11)), <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="fu">sqrt</span>(D22)))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># fixed effects coefficients  </span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>true.betas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.482</span>, <span class="fl">0.243</span>, <span class="fl">1.52</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># linear predictor  </span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>eta.y <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(X <span class="sc">%*%</span> true.betas <span class="sc">+</span> <span class="fu">rowSums</span>(Z <span class="sc">*</span> b[id, ]))</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># residual standard error  </span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>sigma.e <span class="ot">&lt;-</span> <span class="fl">1.242</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># sample longitudinal outcome values  </span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N<span class="sc">*</span>n, eta.y, sigma.e)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># values for the association parameter per transition  </span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;alpha.01&quot;</span> <span class="ot">=</span> <span class="fl">0.8</span>, <span class="st">&quot;alpha.02&quot;</span> <span class="ot">=</span> <span class="fl">0.55</span>, <span class="st">&quot;alpha.12&quot;</span> <span class="ot">=</span> <span class="fl">1.25</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># shape of Weibull for each transition  </span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;phi.01&quot;</span> <span class="ot">=</span> <span class="fl">12.325</span>, <span class="st">&quot;phi.02&quot;</span> <span class="ot">=</span> <span class="fl">8.216</span>, <span class="st">&quot;phi.12&quot;</span> <span class="ot">=</span> <span class="fl">3.243</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># regression coefficients for transition intensities  </span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>gammas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;(Intercept)1&quot;</span> <span class="ot">=</span> <span class="sc">-</span><span class="fl">22.25</span>, <span class="st">&quot;X&quot;</span> <span class="ot">=</span> <span class="fl">1.2</span>,  </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;(Intercept)2&quot;</span> <span class="ot">=</span> <span class="sc">-</span><span class="fl">18.25</span>, <span class="st">&quot;X&quot;</span> <span class="ot">=</span> <span class="fl">1.2</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;(Intercept)3&quot;</span> <span class="ot">=</span> <span class="sc">-</span><span class="fl">19.25</span>, <span class="st">&quot;X&quot;</span> <span class="ot">=</span> <span class="fl">1.2</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># design matrix transition intensities</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">&quot;(Intercept)1&quot;</span><span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, N), Xcov[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="at">by =</span> n, N<span class="sc">*</span>n)], </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;(Intercept)2&quot;</span><span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, N), Xcov[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="at">by =</span> n, N<span class="sc">*</span>n)],</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;(Intercept)3&quot;</span><span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>, N), Xcov[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="at">by =</span> n, N<span class="sc">*</span>n)])</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="do">## linear predictor for transition: 0 -&gt; 1</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>eta.t1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(W[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">drop =</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> gammas[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="do">## linear predictor for transition: 0 -&gt; 2</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>eta.t2 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(W[, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="at">drop =</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> gammas[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="do">## linear predictor for transition: 1 -&gt; 2</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>eta.t3 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(W[, <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="at">drop =</span> <span class="cn">FALSE</span>] <span class="sc">%*%</span> gammas[<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co"># we simulate event times using inverse transform sampling</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>invS01 <span class="ot">&lt;-</span> <span class="cf">function</span>(t, u, i) {</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="cf">function</span>(s) {</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    XX <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, s, Xcov[i])</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    ZZ <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, s)</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    f1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(XX <span class="sc">%*%</span> true.betas <span class="sc">+</span> <span class="fu">rowSums</span>(ZZ <span class="sc">*</span> b[<span class="fu">rep</span>(i, <span class="fu">nrow</span>(ZZ)), ]))</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>(<span class="fu">log</span>(phi[<span class="st">&quot;phi.01&quot;</span>]) <span class="sc">+</span> (phi[<span class="st">&quot;phi.01&quot;</span>] <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span><span class="fu">log</span>(s) <span class="sc">+</span> eta.t1[i] <span class="sc">+</span> f1<span class="sc">*</span>alpha[<span class="st">&quot;alpha.01&quot;</span>])</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">integrate</span>(h, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> t, <span class="at">subdivisions =</span> 10000L)<span class="sc">$</span>value <span class="sc">+</span> <span class="fu">log</span>(u)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>invS02 <span class="ot">&lt;-</span> <span class="cf">function</span>(t, u, i) {</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="cf">function</span>(s) {</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    XX <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, s, Xcov[i])</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    ZZ <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, s)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    f1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(XX <span class="sc">%*%</span> true.betas <span class="sc">+</span> <span class="fu">rowSums</span>(ZZ <span class="sc">*</span> b[<span class="fu">rep</span>(i, <span class="fu">nrow</span>(ZZ)), ]))</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>(<span class="fu">log</span>(phi[<span class="st">&quot;phi.02&quot;</span>]) <span class="sc">+</span> (phi[<span class="st">&quot;phi.02&quot;</span>] <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span><span class="fu">log</span>(s) <span class="sc">+</span> eta.t2[i] <span class="sc">+</span> f1<span class="sc">*</span>alpha[<span class="st">&quot;alpha.02&quot;</span>])</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">integrate</span>(h, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> t, <span class="at">subdivisions =</span> <span class="dv">10000</span>)<span class="sc">$</span>value <span class="sc">+</span> <span class="fu">log</span>(u)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>invS12 <span class="ot">&lt;-</span> <span class="cf">function</span> (t, u, i) {</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="cf">function</span> (s) {</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    XX <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, s, Xcov[i])</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    ZZ <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="dv">1</span>, s)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    f1 <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(XX <span class="sc">%*%</span> true.betas <span class="sc">+</span> <span class="fu">rowSums</span>(ZZ <span class="sc">*</span> b[<span class="fu">rep</span>(i, <span class="fu">nrow</span>(ZZ)), ]))</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>(<span class="fu">log</span>(phi[<span class="st">&quot;phi.12&quot;</span>]) <span class="sc">+</span> (phi[<span class="st">&quot;phi.12&quot;</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">log</span>(s) <span class="sc">+</span> </span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>          eta.t3[i] <span class="sc">+</span> f1 <span class="sc">*</span> alpha[<span class="st">&quot;alpha.12&quot;</span>])</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">integrate</span>(h, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> t, <span class="at">subdivisions =</span> <span class="dv">10000</span>)<span class="sc">$</span>value <span class="sc">+</span> <span class="fu">log</span>(u)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Probability for each transition</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>u01 <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>u02 <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>u12 <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="co"># initiate vectors to save true event times</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>trueT01 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>trueT02 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>trueT12 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="co"># sample censoring times</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>mean.Cens <span class="ot">&lt;-</span> <span class="dv">9</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> mean.Cens)</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate time-to-event data</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  Root01 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>  Root02 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>  Root12 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>  Up <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>  tries <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transition 0-&gt;1</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  Root01 <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">uniroot</span>(invS01, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">1e-05</span>, Up), <span class="at">u =</span> u01[i], <span class="at">i =</span> i)<span class="sc">$</span>root, <span class="cn">TRUE</span>)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(<span class="fu">inherits</span>(Root01, <span class="st">&quot;try-error&quot;</span>) <span class="sc">&amp;&amp;</span> tries <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    tries <span class="ot">&lt;-</span> tries <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    Up <span class="ot">&lt;-</span> Up <span class="sc">+</span> <span class="dv">200</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    Root01 <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">uniroot</span>(invS01, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">1e-05</span>, Up), <span class="at">u =</span> u01[i], <span class="at">i =</span> i)<span class="sc">$</span>root, <span class="cn">TRUE</span>)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>  trueT01[i] <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(Root01, <span class="st">&quot;try-error&quot;</span>)) Root01 <span class="cf">else</span> <span class="dv">500</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transition 0-&gt;2</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>  Root02 <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">uniroot</span>(invS02, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">1e-05</span>, Up), <span class="at">u =</span> u02[i], <span class="at">i =</span> i)<span class="sc">$</span>root, <span class="cn">TRUE</span>)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(<span class="fu">inherits</span>(Root02, <span class="st">&quot;try-error&quot;</span>) <span class="sc">&amp;&amp;</span> tries <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    tries <span class="ot">&lt;-</span> tries <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    Up <span class="ot">&lt;-</span> Up <span class="sc">+</span> <span class="dv">200</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    Root02 <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">uniroot</span>(invS02, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">1e-05</span>, Up), <span class="at">u =</span> u02[i], <span class="at">i =</span> i)<span class="sc">$</span>root, <span class="cn">TRUE</span>)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>  trueT02[i] <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(Root02, <span class="st">&quot;try-error&quot;</span>)) Root02 <span class="cf">else</span> <span class="dv">500</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transition 1-&gt;2</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">as.numeric</span>(trueT01[i]) <span class="sc">&lt;</span> <span class="fu">as.numeric</span>(trueT02[i]) <span class="sc">&amp;&amp;</span> <span class="fu">as.numeric</span>(trueT01[i]) <span class="sc">&lt;</span> C[i]) {</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    Root12 <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">uniroot</span>(invS12, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fu">as.numeric</span>(trueT01[i]), Up), <span class="at">u =</span> u12[i], <span class="at">i =</span> i)<span class="sc">$</span>root, <span class="cn">TRUE</span>)</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span>(<span class="fu">inherits</span>(Root12, <span class="st">&quot;try-error&quot;</span>) <span class="sc">&amp;&amp;</span> tries <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>      tries <span class="ot">&lt;-</span> tries <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>      Up <span class="ot">&lt;-</span> Up <span class="sc">+</span> <span class="dv">200</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>      Root12 <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">uniroot</span>(invS12, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fu">as.numeric</span>(trueT01[i]), Up), <span class="at">u =</span> u12[i], <span class="at">i =</span> i)<span class="sc">$</span>root, <span class="cn">TRUE</span>)</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {Root12 <span class="ot">&lt;-</span> <span class="dv">500</span>}</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  trueT12[i] <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(Root12, <span class="st">&quot;try-error&quot;</span>)) Root12 <span class="cf">else</span> <span class="dv">500</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a><span class="co"># arrange data in appropriate format</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>matsurv <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>datasurv <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (C[k] <span class="sc">&lt;</span> <span class="fu">min</span>(trueT01[k], trueT02[k])) { <span class="co"># if 0 -&gt; C</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>      aux1 <span class="ot">&lt;-</span> <span class="fu">c</span>(k, Xcov.s[k], C[k], <span class="dv">0</span>, C[k], <span class="dv">0</span>)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>      matsurv <span class="ot">&lt;-</span> <span class="fu">rbind</span>(matsurv, aux1) </span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (trueT02[k] <span class="sc">&lt;</span> trueT01[k]) { <span class="co"># if 0 -&gt; 2</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>        aux1 <span class="ot">&lt;-</span> <span class="fu">c</span>(k, Xcov.s[k], trueT02[k], <span class="dv">0</span>, trueT02[k], <span class="dv">1</span>)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>        matsurv <span class="ot">&lt;-</span> <span class="fu">rbind</span>(matsurv, aux1)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (C[k] <span class="sc">&lt;</span> trueT12[k]) { <span class="co"># if 0 -&gt; 1 -&gt; C</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>          aux1 <span class="ot">&lt;-</span> <span class="fu">c</span>(k, Xcov.s[k], trueT01[k], <span class="dv">1</span>, C[k], <span class="dv">0</span>)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>          matsurv <span class="ot">&lt;-</span> <span class="fu">rbind</span>(matsurv, aux1)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> { <span class="co"># if 0 -&gt; 1 -&gt; 2</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>          aux1 <span class="ot">&lt;-</span> <span class="fu">c</span>(k, Xcov.s[k], trueT01[k], <span class="dv">1</span>, trueT12[k], <span class="dv">1</span>)</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>          matsurv <span class="ot">&lt;-</span> <span class="fu">rbind</span>(matsurv, aux1)</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>matlongit <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>aux2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>datalongit <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    n_final <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    n_final <span class="ot">&lt;-</span> <span class="cf">if</span> (matsurv[k, <span class="dv">4</span>] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(time[(n<span class="sc">*</span>(k<span class="dv">-1</span>)<span class="sc">+</span><span class="dv">1</span>) <span class="sc">:</span> (k<span class="sc">*</span>n)] <span class="sc">&lt;</span> trueT12[k])</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (matsurv[k, <span class="dv">6</span>] <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(time[(n<span class="sc">*</span>(k<span class="dv">-1</span>)<span class="sc">+</span><span class="dv">1</span>) <span class="sc">:</span> (k<span class="sc">*</span>n)] <span class="sc">&lt;</span> trueT02[k])</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(time[(n<span class="sc">*</span>(k<span class="dv">-1</span>)<span class="sc">+</span><span class="dv">1</span>) <span class="sc">:</span> (k<span class="sc">*</span>n)] <span class="sc">&lt;</span> C[k])          </span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    aux2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> n_final, <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">c</span>(<span class="fu">rep</span>(k, n_final),</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>                     y[(n<span class="sc">*</span>(k<span class="dv">-1</span>)<span class="sc">+</span><span class="dv">1</span>) <span class="sc">:</span> (n<span class="sc">*</span>(k<span class="dv">-1</span>) <span class="sc">+</span> n_final)],</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>                     time[(n<span class="sc">*</span>(k<span class="dv">-1</span>)<span class="sc">+</span><span class="dv">1</span>) <span class="sc">:</span> (n<span class="sc">*</span>(k<span class="dv">-1</span>) <span class="sc">+</span> n_final)], </span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>                     Xcov[(n<span class="sc">*</span>(k<span class="dv">-1</span>)<span class="sc">+</span><span class="dv">1</span>) <span class="sc">:</span> (n<span class="sc">*</span>(k<span class="dv">-1</span>) <span class="sc">+</span> n_final)]))</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    matlongit <span class="ot">&lt;-</span> <span class="fu">rbind</span>(matlongit, aux2)</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>datasurv <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(matsurv, <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datasurv) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;t_illness&quot;</span>, <span class="st">&quot;illness&quot;</span>, <span class="st">&quot;t_death&quot;</span>, <span class="st">&quot;death&quot;</span>)</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(datasurv) <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(datasurv))</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>datalongit <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(matlongit, <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(datalongit) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;times&quot;</span>, <span class="st">&quot;X&quot;</span>)</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(datalongit) <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(datalongit))</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>tmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>tmat[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>tmat[<span class="dv">2</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(tmat) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">from =</span> <span class="fu">c</span>(<span class="st">&quot;healthy&quot;</span>, <span class="st">&quot;illness&quot;</span>, <span class="st">&quot;death&quot;</span>), </span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>                       <span class="at">to =</span> <span class="fu">c</span>(<span class="st">&quot;healthy&quot;</span>, <span class="st">&quot;illness&quot;</span>, <span class="st">&quot;death&quot;</span>))</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>covs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>)</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>data_mstate <span class="ot">&lt;-</span> JMbayes2<span class="sc">:::</span><span class="fu">ms_setup</span>(<span class="at">data =</span> datasurv, </span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>                        <span class="at">timevars =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">&#39;t_illness&#39;</span>, <span class="st">&#39;t_death&#39;</span>), </span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>                        <span class="at">statusvars =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">&#39;illness&#39;</span>, <span class="st">&#39;death&#39;</span>), </span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>                        <span class="at">transitionmat =</span> tmat, </span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>                        <span class="at">id =</span> <span class="st">&#39;id&#39;</span>, </span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>                        <span class="at">covs =</span> covs)</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>data_mstate<span class="sc">$</span>transition <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_mstate<span class="sc">$</span>transition)</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;datasets&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;long_data&quot;</span> <span class="ot">=</span> datalongit, </span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;data_mstate&quot;</span> <span class="ot">=</span> data_mstate))</span></code></pre></div>
<p>The data for the muti state process need to be in the appropriate long format:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out<span class="sc">$</span>datasets<span class="sc">$</span>data_mstate, <span class="at">n =</span> 5L)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id from_state to_state transition   Tstart    Tstop     time status        X</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1          1        2          1 0.000000 4.392984 4.392984      1 1.984455</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  1          1        3          2 0.000000 4.392984 4.392984      0 1.984455</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  1          2        3          3 4.392984 9.094447 4.701463      0 1.641401</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  2          1        2          1 0.000000 1.552122 1.552122      0 1.984455</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  2          1        3          2 0.000000 1.552122 1.552122      0 7.673231</span></span></code></pre></div>
<p>for example subject 1 experienced the following transition: <span class="math inline">\(1 \rightarrow 2\)</span> and therefore is represented in 3 rows, one for each transition, because all of these transitions were plausible. On the other hand subject 2 is only represented by two rows, only for transitions <span class="math inline">\(1 \rightarrow 2\)</span> and <span class="math inline">\(1 \rightarrow 3\)</span> since these are the only transitions that are possible from state 1. That is, since subject 2 never actually transitioned to state 2, transition <span class="math inline">\(2 \rightarrow 3\)</span> was never possible and therefore no row for this transition is in the dataset. It is also importnt to note that the time in the dataset follows the counting process formulation with intervals specified by <code>Tstart</code> and <code>Tstop</code> and that there is a variable (in this case <code>transition</code>) which indicates to which transition the row correspond to.</p>
</div>
<div id="fitting-the-model" class="section level2">
<h2>Fitting the model</h2>
<p>As soon data in the appropriate format are available, fitting the model is very straightforward. First we fit a linear mixed model using the <code>lme()</code> function from package <strong>nlme</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mixedmodel <span class="ot">&lt;-</span> <span class="fu">lme</span>(Y <span class="sc">~</span> times <span class="sc">+</span> X, <span class="at">random =</span> <span class="sc">~</span> times <span class="sc">|</span> id, <span class="at">data =</span> out<span class="sc">$</span>datasets<span class="sc">$</span>long_data)</span></code></pre></div>
<p>then we fit a multi-state model using function <code>coxph()</code> from package <strong>survival</strong> making sure we use the counting process specification and that we add <code>strata(transition)</code> to stratify by the transition indicator variable in the dataset:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>msmodel <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(Tstart, Tstop, status) <span class="sc">~</span> X <span class="sc">+</span> <span class="fu">strata</span>(transition), <span class="at">data =</span> out<span class="sc">$</span>datasets<span class="sc">$</span>data_mstate)</span></code></pre></div>
<p>Finally, to fit the joint model we simply run:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>jm_ms_model <span class="ot">&lt;-</span> <span class="fu">jm</span>(msmodel, mixedmodel, <span class="at">time_var =</span> <span class="st">&quot;times&quot;</span>, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">functional_forms =</span> <span class="sc">~</span> <span class="fu">value</span>(Y)<span class="sc">:</span>transition, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_iter =</span> 10000L, <span class="at">GK_k =</span> 7L)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(jm_ms_model)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; jm(Surv_object = msmodel, Mixed_objects = mixedmodel, time_var = &quot;times&quot;, </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     functional_forms = ~value(Y):transition, n_iter = 10000L, </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     GK_k = 7L)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Data Descriptives:</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of Groups: 500        Number of events: 518 (39.5%)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of Observations:</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Y: 5461</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                  DIC     WAIC      LPML</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; marginal    25526.68 33583.58 -21783.63</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; conditional 25401.26 32018.02 -22830.62</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Random-effects covariance matrix:</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     </span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        StdDev   Corr</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intr) 1.1011 (Intr)</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; times  0.6832 0.0284</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Survival Outcome:</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                         Mean  StDev    2.5%  97.5%      P   Rhat</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; X                    -0.0200 0.0330 -0.0853 0.0440 0.5463 1.0010</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; value(Y):transition1  0.1855 0.0187  0.1485 0.2227 0.0000 1.0072</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; value(Y):transition2  0.3971 0.0338  0.3304 0.4585 0.0000 1.0707</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; value(Y):transition3 -0.0224 0.0185 -0.0583 0.0141 0.2154 1.0017</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Longitudinal Outcome: Y (family = gaussian, link = identity)</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                Mean  StDev    2.5%  97.5%      P   Rhat</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept) -0.4376 0.6769 -1.7852 0.9028 0.5032 1.0003</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; times        0.3417 0.1316  0.0829 0.6018 0.0116 1.0002</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; X            1.5377 0.0439  1.4507 1.6254 0.0000 1.0012</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sigma        1.3438 0.0860  1.2403 1.5591 0.0000 1.0053</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; MCMC summary:</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; chains: 3 </span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; iterations per chain: 10000 </span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; burn-in per chain: 500 </span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; thinning: 1 </span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; time: 3.2 min</span></span></code></pre></div>
<p>which differs from a default call to <code>jm()</code> by the addition of the <code>functional_forms</code> argument by which we specify that we want an “interaction” between the value of the marker and each transition which translates into a separate association parameter for the longitudinal marker and each transition.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
